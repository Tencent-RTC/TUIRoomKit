import TRTCCloud from '@tencentcloud/trtc-cloud-wx'

const trtcCloud = TRTCCloud.getTRTCShareInstance()
const trtc = trtcCloud.trtc
const InterfaceEventEmitter = trtcCloud.InterfaceEventEmitter

Component({
  properties: {
    // trtcCloud: {
    //   type: Object,
    // }
  },
  data: {
    pusher: {},
  },
  lifetimes: {
    attached() {
      this.bindTRTCCloudEvent()
    },
    detached() {
      this.unbindTRTCCloudEvent()
      trtcCloud.exitRoom()
    },
  },


  methods: {
    pusherAttributesChange(event) {
      const {pusher, callback} = event
      this.setData({pusher}, callback)
    },
    bindTRTCCloudEvent() {
      InterfaceEventEmitter.on('pusherAttributesChange', this.pusherAttributesChange, this)
    },
    unbindTRTCCloudEvent() {
      InterfaceEventEmitter.off('playerAttributesChange', this.pusherAttributesChange)
    },
    // 请保持跟 wxml 中绑定的事件名称一致
    _pusherStateChangeHandler(event) {
      trtc.pusherEventHandler(event)
    },
    _pusherNetStatusHandler(event) {
      trtc.pusherNetStatusHandler(event)
    },
    _pusherErrorHandler(event) {
      trtc.pusherErrorHandler(event)
    },
    _pusherBGMStartHandler(event) {
      trtc.pusherBGMStartHandler(event)
    },
    _pusherBGMProgressHandler(event) {
      trtc.pusherBGMProgressHandler(event)
    },
    _pusherBGMCompleteHandler(event) {
      trtc.pusherBGMCompleteHandler(event)
    },
    _pusherAudioVolumeNotify(event) {
      if (!trtcCloud.isEnterRoom) {
        return
      }
      trtc.pusherAudioVolumeNotify(event)
    }
  }
})
